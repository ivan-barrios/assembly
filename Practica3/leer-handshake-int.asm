PIC EQU 20H
EOI EQU 20H
HAND EQU 40H
N_HND EQU 10

ORG 40
    IP_HND DW RUT_HND


ORG 1000H
    CANT_CAR DB 5
    CAR DB ?

ORG 3000H
RUT_HND: PUSH AX
MOV AL, [BX]
OUT HAND, AL
CMP DL, 0
JNZ ALREVES
INC BX
DEC CL
JMP CONTINUAR
ALREVES: DEC BX
INC CL

CONTINUAR: MOV AL, EOI
OUT EOI, AL
POP AX
IRET

ORG 2000H
MOV BX, OFFSET CAR
MOV CL, CANT_CAR

;LEO LOS DATOS
LEER: INT 6
    INC BX
    DEC CL
    JNZ LEER
MOV BX, OFFSET CAR
MOV CL, CANT_CAR

;CONFIGURO HANDSHAKE
IN AL, HAND+1
OR AL, 80H
OUT HAND+1, AL ; CONFIGURO HAND PARA QUE SEA POR INTERRUPCION


;CONFIGURACION DEL PIC
CLI
MOV AL, 11111011b
OUT PIC+1, AL ; Habilito las interrupciones por HANDSHAKE
MOV AL, N_HND
OUT PIC+6, AL ; DIREC DE RUT_HND
STI

MOV DL, 0 ; SI ESTA EN 0 -> INC BX Y DEC CL

LAZO1: CMP CL, 0
JNZ LAZO1

DEC BX ; ULTIMO CARACTER

MOV DL, 1 ; SI ESTA EN 1 -> DEC BX E INC CL

LAZO2: CMP CL, 5
JNZ LAZO2

;DESACTIVO HAND POR INTERRUPCIONES
IN AL, HAND+1
AND AL, 01111111b
OUT HAND+1, AL

INT 0
END
